generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id          Int       @id @default(autoincrement())
  username    String    @unique(map: "username") @db.VarChar(100)
  password    String    @db.VarChar(255)
  salt        String    @db.VarChar(255)
  active      Boolean?  @default(true)
  created_at  DateTime? @default(now()) @db.Timestamp(0)
  modified_at DateTime? @db.Timestamp(0)
  patient     patient[]

  @@index([username], map: "idx_users_username")
}

model staff {
  id              Int               @id @default(autoincrement())
  name            String            @db.VarChar(100)
  phone_number    String?           @db.VarChar(20)
  active          Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamp(0)
  modified_at     DateTime?         @db.Timestamp(0)
  medical_history medical_history[]
}

model patient {
  id              Int                 @id @default(autoincrement())
  patient_code    String              @unique(map: "patient_code") @db.VarChar(50)
  name            String              @db.VarChar(150)
  gender          patient_gender
  date_of_birth   DateTime?           @db.Date
  phone           String?             @db.VarChar(20)
  email           String?             @db.VarChar(100)
  address         String?             @db.Text
  blood_type      patient_blood_type?
  allergies       String?             @db.Text
  medical_notes   String?             @db.Text
  created_by      Int?
  created_at      DateTime?           @default(now()) @db.Timestamp(0)
  updated_at      DateTime?           @default(now()) @db.Timestamp(0)
  medical_history medical_history[]
  users           users?              @relation(fields: [created_by], references: [id], onUpdate: NoAction, map: "fk_patient_created_by")

  @@index([created_by], map: "fk_patient_created_by")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model medical_history {
  id                       Int       @id @default(autoincrement())
  patient_id               Int
  appointment_date         DateTime  @db.DateTime(0)
  staff_id                 Int?
  service_type             String?   @db.VarChar(100)
  diagnosis_result         String?   @db.Text
  pain_before              Int?      @db.TinyInt
  pain_after               Int?      @db.TinyInt
  treatments               String?   @db.VarChar(255)
  exercise                 String?   @db.Text
  homework                 String?   @db.Text
  recommended_next_session String?   @db.VarChar(100)
  additional_notes         String?   @db.Text
  created_at               DateTime? @default(now()) @db.Timestamp(0)
  updated_at               DateTime? @default(now()) @db.Timestamp(0)
  patient                  patient   @relation(fields: [patient_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_medical_history_patient")
  staff                    staff?    @relation(fields: [staff_id], references: [id], onUpdate: NoAction, map: "fk_medical_history_staff")

  @@index([appointment_date], map: "idx_appointment_date")
  @@index([patient_id], map: "idx_patient_id")
  @@index([staff_id], map: "idx_staff_id")
}

enum patient_gender {
  MALE
  FEMALE
}

enum patient_blood_type {
  A
  B
  AB
  O
}
